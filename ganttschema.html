<script>
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwy0b0RMcUXo3xguOtukMryHNlYnebQdskaIWHXr3POx7fg9NfUHsMTGjOlDnkOJZybrWZ7r36NfB1/pub?output=csv';

  function extractDateOnly(str) {
    const match = str?.match(/^(\d{4}-\d{2}-\d{2})/);
    return match ? new Date(match[1]) : null;
  }

  google.charts.load('current', { packages: ['gantt'] });
  google.charts.setOnLoadCallback(loadAndDraw);  // <- denna fungerar nu

  function loadAndDraw() {
    const testData = [
      {
        id: 'task-1',
        namn: 'Testcup',
        typ: 'Cup',
        start: new Date('2025-09-12'),
        end: new Date('2025-09-14'),
        färg: '#4CAF50'
      },
      {
        id: 'task-2',
        namn: 'USM Steg 1',
        typ: 'USM',
        start: new Date('2025-10-18'),
        end: new Date('2025-10-19'),
        färg: '#2196F3'
      }
    ];

    const dataTable = new google.visualization.DataTable();
    dataTable.addColumn('string', 'Task ID');
    dataTable.addColumn('string', 'Händelse');
    dataTable.addColumn('string', 'Typ');
    dataTable.addColumn('date', 'Start');
    dataTable.addColumn('date', 'End');
    dataTable.addColumn('number', 'Duration');
    dataTable.addColumn('number', 'Progress');
    dataTable.addColumn('string', 'Resurs');
    dataTable.addColumn({ type: 'string', role: 'style' });

    testData.forEach(row => {
      dataTable.addRow([
        row.id,
        row.namn,
        row.typ,
        row.start,
        row.end,
        null,
        100,
        row.typ,
        row.färg
      ]);
    });

    const chart = new google.visualization.Gantt(document.getElementById('chart_div'));
    try {
      chart.draw(dataTable, {
        height: Math.max(600, dataTable.getNumberOfRows() * 40),
        gantt: {
          trackHeight: 30
        }
      });
      console.log('✅ Gantt med testdata renderad!');
    } catch (err) {
      console.error('❌ Google Charts error:', err);
    }
  }
</script>
