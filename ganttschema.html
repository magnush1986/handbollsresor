<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Testa Gantt ‚Äì Fels√∂kning</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>Test Gantt</h1>
  <div id="chart_div" style="margin-top: 2rem;"></div>

  <script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwy0b0RMcUXo3xguOtukMryHNlYnebQdskaIWHXr3POx7fg9NfUHsMTGjOlDnkOJZybrWZ7r36NfB1/pub?output=csv';

    function extractDateOnly(str) {
      const match = str?.match(/^(\d{4}-\d{2}-\d{2})/);
      return match ? new Date(match[1]) : null;
    }

    google.charts.load('current', { packages: ['gantt'] });
    google.charts.setOnLoadCallback(loadAndDraw);

    function loadAndDraw() {
      Papa.parse(SHEET_URL, {
        download: true,
        header: true,
        complete: function(results) {
          const all = results.data.filter(e => e['S√§song'] === '2025-2026').slice(0, 3);
          console.log('üîç Testdata:', all);

          const dataTable = new google.visualization.DataTable();
          dataTable.addColumn('string', 'Task ID');
          dataTable.addColumn('string', 'H√§ndelse');
          dataTable.addColumn('string', 'Typ');
          dataTable.addColumn('date', 'Start');
          dataTable.addColumn('date', 'End');
          dataTable.addColumn('number', 'Duration');
          dataTable.addColumn('number', 'Progress');
          dataTable.addColumn('string', 'Resurs');
          dataTable.addColumn({ type: 'string', role: 'style' });

          let counter = 1;

          all.forEach(e => {
            const id = 'task-' + counter++;
            const namn = e['Namn p√• h√§ndelse']?.trim() || 'Ok√§nd';
            const typ = e['Typ av h√§ndelse']?.trim() || '√ñvrigt';
            const start = extractDateOnly(e['Datum fr√•n']);
            const end = extractDateOnly(e['Datum till']);
            const f√§rg = {
              'Cup': '#4CAF50',
              'USM': '#2196F3',
              'Seriematcher': '#9C27B0',
              'Tr√§ningsmatch': '#FF9800',
              '√ñvrigt': '#9E9E9E'
            }[typ] || '#757575';

            if (!start || !end || isNaN(start) || isNaN(end)) {
              console.warn('‚õî Ogiltigt datum i rad:', e);
              return;
            }

            if (!namn || !typ) {
              console.warn('‚ö†Ô∏è Saknad textinfo i rad:', e);
            }

            dataTable.addRow([
              id,
              namn,
              typ,
              start,
              end,
              null,
              100,
              typ,
              f√§rg
            ]);
          });

          const chart = new google.visualization.Gantt(document.getElementById('chart_div'));
          try {
            chart.draw(dataTable, {
              height: 400 + dataTable.getNumberOfRows() * 30,
              gantt: { trackHeight: 30 }
            });
            console.log('‚úÖ Gantt renderad!');
          } catch (err) {
            console.error('‚ùå Fel vid draw():', err);
          }
        }
      });
    }
  </script>
</body>
</html>
